<!DOCTYPE html>
<html>
<head>
<title>logs.moe</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📃</text></svg>" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css" />
<link rel="stylesheet" href="/styles.css" />
<script type="module">
import hljs from "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/es/highlight.min.js";
import { decrypt } from "/libs/subtle.mjs";

;(async function () {
  const contentType = "<%= contentType %>";
  const iv = new Uint8Array([<%= iv %>]);
  const uuid = location.pathname.slice(1);
  const [k, language] = location.hash.slice(1).split(".");
  const element = document.createElement("pre");
  let child = document.createElement("code");

  try {
    const response = await fetch(`/data/${uuid}`);
    const encrypted = await response.arrayBuffer();
    const buffer = await decrypt(iv, k, encrypted);

    if (contentType.startsWith("image/")) {
      child = document.createElement("img");
      child.src = URL.createObjectURL(new Blob([buffer]));
    } else {
      child.textContent = new TextDecoder().decode(buffer) || "empty 👀";
    }
  } catch (err) {
    console.error(err);
    child.textContent = "failed 💀";
  } finally {
    element.appendChild(child)
    document.body.innerHTML = "";
    document.body.appendChild(element);

    if (language) {
      hljs.configure({ languages: [language] });
    }
    hljs.highlightAll();
  }
})();
</script>
</head>
<body><pre><code>working ⏳</code></pre></body>
</html>
